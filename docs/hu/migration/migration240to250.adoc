= v2.4.0 ‚Üí v2.5.0

coff:ee v2.4.0 -> v2.5.0 migr√°ci√≥s le√≠r√°s, √∫jdons√°gok, v√°ltoz√°sok le√≠r√°sa

== Global

üí• ***BREAKING CHANGE*** üí•
```
Glob√°lis v√°ltoz√°s, hogy a projekteken eddig a coffee-bom volt haszn√°lva a coffee dependency import√°l√°s√°hoz. Ez megv√°ltozott coffee-bom-project -re.

Ezut√°n a k√∂vetkez≈ë m√≥don kell import√°lni a projekt elemeit:

<dependencyManagement>
    <dependency>
        <groupId>hu.icellmobilsoft.coffee</groupId>
        <artifactId>coffee-bom-project</artifactId> <1>
        <version>${version.hu.icellmobilsoft.coffee}</version>
        <type>pom</type>
        <scope>import</scope>
    </dependency>
</dependencyManagement>


Ez azzal is j√°r, hogy azon transparens dependency-k melyek eddig a coffee-bom miatt a projektekre ker√ºltek, √≠gy kiker√ºlnek.
Emiatt ezeket a dependency-ket a maven jelezni fogja hogy nem tal√°lja, √≠gy azokat defini√°lni kell a coffee-t felhaszn√°l√≥ projekten.
```
<1> - coffee-bom -> coffee-bom-project -re v√°ltozott

* jandex-maven-plugin - indexel√©sb≈ël kiker√ºltek a test oszt√°lyok

== Metrika f√ºggetlen√≠t√©se
T√∂bb modult √©rint≈ë fejleszt√©s, aminek a c√©lja hogy a metrika t√∂bb fajta implement√°ci√≥val
tudjon m≈±k√∂dni.

=== coffee-jpa & coffee-module-redis

* A modulok f√ºggetlen√≠tve volt a metrika implement√°ci√≥j√°t√≥l,
szabadon v√°laszthat√≥ a microprofile-metrics vagy micrometer k√∂z√∂tt
* √°tmozgatva `hu.icellmobilsoft.coffee.jpa.health.DatabaseHealthConstant.DEFAULT_DATASOURCE_NAME` ->
`hu.icellmobilsoft.coffee.cdi.config.IConfigKey.DATASOURCE_DEFAULT_NAME_VALUE`

==== Migration

Dependency szinten kell megv√°lasztani milyen metrika implement√°ci√≥-t haszn√°ljon a szervice,
egy√©bk√©nt minden m√°s visszafel√© kompatibilis.

[source,xml]
----
<dependency>
    <groupId>hu.icellmobilsoft.coffee</groupId>
    <artifactId>coffee-module-mp-micrometer</artifactId> <1>
</dependency>
<!-- vagy -->
<dependency>
    <groupId>hu.icellmobilsoft.coffee</groupId>
    <artifactId>coffee-module-mp-metrics</artifactId> <2>
</dependency>
----
<1> Micrometer metrika implement√°ci√≥
<2> Microprofile-metrics metrika implement√°ci√≥

=== coffee-grpc-metrics-impl

√Åtnevez√©s coffee-grpc-metrics-impl -> coffee-grpc-metrics-mpmetrics

==== Migration

N√©v v√°ltoz√°son k√≠v√ºl a v√°ltoztat√°sok nem eredm√©nyeznek √°t√°ll√°si munk√°latokat, visszafel√© kompatibilis.

== Egy√©b fejleszt√©sek

=== coffee-tool

* L√©trej√∂tt √∫j "AES/CBC/PKCS5PADDING" k√≥dol√≥ oszt√°ly
(`hu.icellmobilsoft.coffee.tool.utils.crypto.AesCbcCryptoUtil`)
* Hozz√° adva a SHA3-512 k√≥dol√≥ met√≥dus a `hu.icellmobilsoft.coffee.tool.utils.string.EncodeUtil` oszt√°lyhoz,
r√©gi `Sha512(String str)` kivezet√©sre fog ker√ºlni.
* MavenURLHandler oszt√°lyban aktu√°lis sz√°l alapot√∫ resource lek√©r√©st ker√ºl.
* A `ResponseEntityCollectorOutputStream` m√≥dos√≠t√°sra ker√ºlt, a t√∂bb byte-on √°br√°zolt karaktereket (pl. UTF-8 magyar √©kezetes karakterek) eddig karakterre castolva t√°rolta, ami hib√°s sz√∂veget eredm√©nyezhetett. Tov√°bbiakban byte-k√©nt t√°roljuk, ennek sz√∂vegg√© alak√≠t√°sakor a h√≠v√≥ f√©l felel≈ëss√©ge a megfelel≈ë karakter k√≥dol√°s haszn√°lata.

==== Migration

A v√°ltoztat√°sok nem eredm√©nyeznek √°t√°ll√°si munk√°latokat, visszafel√© kompatibilis.

=== coffee-module-redisstream

* Graceful le√°ll√≠t√°st seg√≠t≈± m≈±k√∂d√©st kaptak a redis consumerek
(`hu.icellmobilsoft.coffee.module.redisstream.bootstrap.ConsumerLifeCycleManager`)

==== Migration

A v√°ltoztat√°sok nem eredm√©nyeznek √°t√°ll√°si munk√°latokat, visszafel√© kompatibilis.

=== coffee-rest

* Ha nincs defini√°lva a version a validateXMLs annot√°ci√≥ban, akkor nem pr√≥b√°lja meg kiolvasni a requestVersion a requestb≈ël.
* √Åtmozgat√°sra ker√ºltek a `hu.icellmobilsoft.coffee.rest.validation.xml.annotation.ValidateXML` √©s `hu.icellmobilsoft.coffee.rest.validation.xml.annotation.ValidateXMLs` annot√°ci√≥k a coffee-cdi modul al√°.

==== Migration

A v√°ltoz√°s eredm√©nyek√©ppen, ha felhaszn√°l√°si oldalon is hivatkozva van ezen annot√°ci√≥kra, friss√≠teni kell az importokat:
`hu.icellmobilsoft.coffee.rest.validation.xml.annotation.ValidateXML` -> `hu.icellmobilsoft.coffee.cdi.annotation.xml.ValidateXML`
`hu.icellmobilsoft.coffee.rest.validation.xml.annotation.ValidateXMLs` -> `hu.icellmobilsoft.coffee.cdi.annotation.xml.ValidateXMLs`

=== coffee-module-etcd

* A `@Deprecated(since = "1.3.0", forRemoval = true)` annot√°ci√≥val ell√°tott osz√°lyok √©s met√≥dusok t√∂r√∂lve lettek.

==== Migration

* `hu.icellmobilsoft.coffee.module.etcd.service.BaseEtcdService` t√∂r√∂lve lett.
Teljes √©rt√©k≈± helyettese a `hu.icellmobilsoft.coffee.module.etcd.service.EtcdService` oszt√°ly,
mely kifejezetten String √©rt√©kekkel dolgozik.
* A `getList()` met√≥dus t√∂r√∂lve lett innen: `hu.icellmobilsoft.coffee.module.etcd.service.ConfigEtcdService`. Ezent√∫l a kompatibilis `getAll()` met√≥dust kell haszn√°ni.

=== coffee-jpa

* `@Dependent` annot√°ci√≥ hozz√°adva ehhez az oszt√°lyhoz: `hu.icellmobilsoft.coffee.jpa.sql.batch.BatchService`

==== Migration

A v√°ltoztat√°sok nem eredm√©nyeznek √°t√°ll√°si munk√°latokat, visszafel√© kompatibilis.

=== coffee-module-configdoc

* Ha egy `@ConfigDoc` annot√°ci√≥ el≈ëtt nem szerepelt java doc, akkor ford√≠t√°s sor√°n nullpointer keletkezett.

==== Migration

A v√°ltoztat√°sok nem eredm√©nyeznek √°t√°ll√°si munk√°latokat, visszafel√© kompatibilis.

=== coffee-module-mp-restclient

* FaultTypeParserExtension m√≥dosult, ezent√∫l azokat az enumokat t√∂lti be, melyeken pluszban szerepel a `@hu.icellmobilsoft.coffee.cdi.annotation.FaultTypeCode` annot√°ci√≥.
* Az IFaultType interf√©sz deprecated-d√© v√°lt.

==== Migration

Ha van FaultType enumod a projekteden, add hozz√° @`@FaultTypeCode` annot√°ci√≥t √©s t√∂r√∂ld az `IFaultType` interf√©szt. A beans.xml f√°jlnak ott kell lennie a META-INF k√∂nyvt√°rban!

== Trace f√ºggetlen√≠t√©se
T√∂bb modult √©rint≈ë fejleszt√©s, aminek a c√©lja hogy a tracing t√∂bb fajta implement√°ci√≥val
tudjon m≈±k√∂dni.

=== coffee-cdi

* √Åtnevez√©s hu.icellmobilsoft.coffee.cdi.trace.constants.Tags -> hu.icellmobilsoft.coffee.cdi.trace.constants.SpanAttribute
* Alap opentelemetry standard constansokat kapott.
* `@Traced` annot√°ci√≥ default `INTERNAL` kind t√≠pussal szolg√°ltat trace-t amennyiben nem ker√ºl megad√°sra az annot√°ci√≥ haszn√°lat√°n√°l.
* √Åtnevez√©s hu.icellmobilsoft.coffee.cdi.trace.spi.IOpenTraceHandler -> hu.icellmobilsoft.coffee.cdi.trace.spi.ITraceHandler

==== Migration

Dependency szinten kell megv√°lasztani milyen tracing implement√°ci√≥-t haszn√°ljon a szervice,
egy√©bk√©nt minden m√°s visszafel√© kompatibilis.

[source,xml]
----
<dependency>
    <groupId>hu.icellmobilsoft.coffee</groupId>
    <artifactId>coffee-module-mp-opentracing</artifactId> <1>
</dependency>
<!-- vagy -->
<dependency>
    <groupId>hu.icellmobilsoft.coffee</groupId>
    <artifactId>coffee-module-mp-telemetry</artifactId> <2>
</dependency>
----
<1> microprofile-opentracing implement√°ci√≥
<2> microprofile-telemetry implement√°ci√≥

Amennyiben a `hu.icellmobilsoft.coffee.cdi.trace.constants.Tags` √©rt√©kek voltak haszn√°lva, helyette a `hu.icellmobilsoft.coffee.cdi.trace.constants.SpanAttribute` oszt√°lyban tal√°lhat√≥k meg a konstansok.

Az `IOpenTraceHandler` inject helyett `ITraceHandler`-t kell inject√°lni.

=== coffee-grpc-opentracing-impl

* √Åtnevez√©s coffee-grpc-opentracing-impl -> coffee-grpc-traces-mpopentracing

==== Migration

* dependency coffee-grpc-opentracing-impl helyett coffee-grpc-tracing-opentracing

=== coffee-grpc-traces-api

* ITracesInterceptor megsz≈±nt, egyszer≈±bb interceptor keres√©s √©rdek√©ben.

==== Migration

* Saj√°t interceptor k√©sz√≠t√©sekor haszn√°ljuk a be√©p√≠tett `io.grpc.ServerInterceptor` az `ITracesInterceptor` helyett.

=== coffee-module-mongodb

* A `@Deprecated(forRemoval = true, since = "1.1.0")` annot√°ci√≥val ell√°tott osz√°lyok √©s met√≥dusok t√∂rl√©se.
* Az implement√°latlan, haszn√°laton k√≠v√ºli met√≥dus t√∂rl√©se: `hu.icellmobilsoft.coffee.module.mongodb.service.MongoService#getMongoCollectionName()`

==== Migration

* A `hu.icellmobilsoft.coffee.module.mongodb.annotation.MongoConfiguration` oszt√°ly helyett ezt az oszt√°lyt kell haszn√°lni: `hu.icellmobilsoft.coffee.module.mongodb.extension.MongoClientConfiguration`
* A `hu.icellmobilsoft.coffee.module.mongodb.config.MongoDbConfig` oszt√°ly helyett ezt az oszt√°lyt kell haszn√°lni: `hu.icellmobilsoft.coffee.module.mongodb.extension.MongoConfigHelper`
* A `hu.icellmobilsoft.coffee.module.mongodb.config.MongoDbConfigImpl` oszt√°ly helyett ezt az oszt√°lyt kell haszn√°lni: `hu.icellmobilsoft.coffee.module.mongodb.extension.MongoClientConfiguration`
* A `hu.icellmobilsoft.coffee.module.mongodb.handler.MongoDbHandler` oszt√°ly helyett ezt az oszt√°lyt kell haszn√°lni: `hu.icellmobilsoft.coffee.module.mongodb.extension.MongoDbClient`
* A `hu.icellmobilsoft.coffee.module.mongodb.producer.MongoFactory` oszt√°ly helyett ezt az oszt√°lyt kell haszn√°lni: `hu.icellmobilsoft.coffee.module.mongodb.extension.MongoDbClientFactory`
* A `hu.icellmobilsoft.coffee.module.mongodb.service.MongoServiceImpl` oszt√°ly helyett ezt az oszt√°lyt kell haszn√°lni: `hu.icellmobilsoft.coffee.module.mongodb.extension.MongoDbClient`
* A `hu.icellmobilsoft.coffee.module.mongodb.service.MongoService#getMongoCollection()`  met√≥dus helyett ezt kell haszn√°lni: `hu.icellmobilsoft.coffee.module.mongodb.extension.MongoDbClient#initRepositoryCollection(java.lang.String)`